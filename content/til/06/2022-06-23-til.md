---
emoji: 📝
title: "[코드스쿼드] - 220623 TIL"
date: '2022-06-23 10:00:00'
author: 포키
tags: TIL, 이슈트래커
categories: TIL
---


## 🛎 **하루 일과**

> 10:00 ~ 10:30 데일리 스크럼  
> 10:30 ~ 12:30 Issue Tracker 프로젝트  
> 15:00 ~ 16:00 무신사 컴퍼니데이  
> 16:00 ~ 17:30 Issue Tracker 프로젝트  

<br>

## **🤝 Issue Tracker 9일차**

---

### 📝 작업


- 인터셉터에서 유저 객체를 조회하는 대신 유저 id만 넘겨주도록 변경
- 유저 정보 조회 api 구현
- pr 리뷰 반영

---

### 💭 고민사항


### 핸들러 인터셉터와 영속성 컨텍스트 실행 시점

어제 막혔던 부분을 산토리와 함께 고민하다가 원인을 발견했다.  


OSIV라는 개념이 있다.
Open Session In View인데, 기본적으로 영속성 컨텍스트는 트랜잭션이 시작되는 시점에 생겨서 트랜잭션이 종료되면 함께 사라진다. 즉, **같은 생명주기**를 갖는다.
하지만 Spring에서 기본적으로 OSIV 설정이 `true`로 되어 있는데, 이는 Service 레이어에서 트랜잭션이 종료된 이후에도 영속성 컨텍스트가 살아있어서 UI 레이어에서까지 사용할 수 있다는 의미다.  

그렇다면 OSIV 기본 설정이 true인데 왜 인터셉터에서 조회한 엔티티 객체는 영속성 컨텍스트에서 관리가 되지 않았을까? 

> `영속성 컨텍스트`가 생성되는 시점보다 `핸들러 인터셉터` 가 실행되는 시점이 앞서 있기 때문이다.

핸들러 인터셉터가 실행되는 시점에는 영속성 컨텍스트가 생성되지 않았기 때문에 Repository에서 조회를 하더라도 영속성 컨텍스트에 들어가지를 않는다. 실제로 3번 연달아서 조회를 해본 결과 모두 다른 객체가 반환된다.
위의 문제를 해결하기 위해서 ArgumentResolver에서 조회를 할까 했지만, 현재 로직 상 유저를 모든 api에서 조회할 필요는 없다고 느껴져서 userId를 그냥 넘겨주도록 수정했다.

원인을 찾느라 오전 시간을 모두 사용했지만 그만큼 값진 삽질이었다.  
우테코 블로그에 해당 내용에 대한 글 덕분에 원인을 명확히 알 수 있었다. 글 링크를 첨부한다.  
- [우테코 글 링크](https://tecoble.techcourse.co.kr/post/2020-11-03-osiv_with_interceptor/)

<br>
